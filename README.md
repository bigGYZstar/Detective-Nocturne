# 探偵ノクターン -銀の黄昏とアザゼルの鍵-

## 🎮 ゲーム概要

**探偵ノクターン -銀の黄昏とアザゼルの鍵-** は、Godot 4.5エンジンで開発された18禁ビジュアルノベル・アドベンチャーゲームです。

### 基本情報
- **ジャンル**: ビジュアルノベル・アドベンチャーゲーム
- **対象年齢**: 18歳以上
- **プラットフォーム**: PC (Windows/Mac/Linux)
- **エンジン**: Godot 4.5
- **開発段階**: データ駆動シナリオ実装 v0.2

### ストーリー
探偵の水島みずきと助手の田村沙織が、一条瑠璃からの依頼を受けて行方不明になった父親を探す物語。『銀の黄昏会』という謎の宗教団体と『アザゼルの鍵』という古い遺物を巡る、深い人間ドラマが展開されます。

## 🚀 セットアップ

### 必要環境
- **Godot Engine**: 4.5以上
- **OS**: Windows 10/11, macOS 10.15+, Ubuntu 20.04+
- **メモリ**: 4GB RAM以上
- **ストレージ**: 2GB以上の空き容量

### インストール手順

1. **リポジトリのクローン**
```bash
git clone https://github.com/bigGYZstar/Detective-Nocturne.git
cd Detective-Nocturne
```

2. **Godotエンジンのダウンロード**
```bash
# Linux版の場合
wget https://github.com/godotengine/godot/releases/download/4.5-stable/Godot_v4.5-stable_linux.x86_64.zip
unzip Godot_v4.5-stable_linux.x86_64.zip
chmod +x Godot_v4.5-stable_linux.x86_64
```

3. **プロジェクトのインポート**
```bash
# ヘッドレスモードでプロジェクトをインポート
./Godot_v4.5-stable_linux.x86_64 --headless --quit --path . --import
```

4. **ゲームの実行**
```bash
# エディタで開く
./Godot_v4.5-stable_linux.x86_64 --path .

# 直接実行（エクスポート後）
./Godot_v4.5-stable_linux.x86_64 --headless --path . --main-pack game.pck
```

## 🎯 現在の実装状況（v0.2）

### ✅ 実装済み機能
- **データ駆動シナリオシステム**: シナリオデータがJSONファイルに一元化され、Godotエンジンから独立して管理されます。
- **アセット管理**: `manifest.json`を介したアセット参照により、パス直書きを排除。
- **基本UI**: ダイアログシステム、メニューシステム
- **章タイトル表示**: 各章の始まりに日本語タイトルと英語サブタイトルを表示するシステム。フェードイン/アウトアニメーション、スキップ機能付き。
- **キャラクター表示**: 主要3キャラクターの立ち絵（通常、驚き、悲しみなどの表情差分を含む）
- **シナリオシステム**: 序章および第二章のデータ駆動型シナリオ実装
- **ゲーム管理**: 状態管理、フラグ管理、好感度システム
- **設定システム**: 音量調整、テキスト速度、フルスクリーン
- **セーブ・ロード**: 10スロット対応のセーブシステム（行ID基準での復元に対応）
- **既読・スキップ・ジャンプ**: 行ID基準での動作に対応
- **シナリオデータバリデーション**: 重複ID、未解決参照、未定義ジャンプ、言語欠落の検出機能

### 🔄 開発中機能
- 音声・BGMシステム
- CG鑑賞モード
- 全章のシナリオ実装
- 18禁シーンの詳細実装
- エフェクト・演出システム

## 📖 データ駆動シナリオシステム

本プロジェクトでは、シナリオの管理をデータ駆動型に移行しました。これにより、以下のメリットが実現されます。

- **セーブ互換性**: シナリオの各コマンドに一意のIDを付与することで、セーブデータの互換性を高め、将来のシナリオ変更にも柔軟に対応できます。**行IDは一度付与したら絶対に変更しない運用を厳守してください。**
- **既読制御**: 各コマンドの既読状態を行IDで管理し、既読スキップや未読停止を正確に制御します。
- **翻訳拡張**: `text`フィールドは多言語辞書形式（例: `"text": {"ja": "日本語テキスト", "en": "English text"}`）または単一のキー参照（例: `"text": "TEXT_KEY_001"`）のどちらでも扱えるように設計されており、将来の翻訳分離に備えています。
- **演出差し替えの耐性**: シナリオロジックと表示ロジックを分離することで、演出の変更がシナリオデータに影響を与えにくくなります。
- **章追加の効率化**: 新しい章の追加は、対応するJSONファイルを`data/scenarios`ディレクトリに配置するだけで可能になります。

### データ構造

- **章データ**: `data/scenarios/<chapter>.json`
  - 各章のシナリオコマンドをJSON形式で格納。各コマンドは一意の`id`を持つ。
  - 章タイトル表示コマンド例:
    ```json
    {
      "id": "C01-0000",
      "type": "show_chapter_title",
      "japanese_title": "持たざる者",
      "english_title": "CHAPTER 1  THE MEAGER",
      "duration": 3.0
    }
    ```
- **アセット辞書**: `data/assets/manifest.json`
  - キャラクター画像、背景画像、UI要素などのアセットパスをキー参照で一元管理。コードからのパス直書きを排除。

### 章タイトル表示機能

各章の始まりに、リファレンスデザインに基づいた章タイトル画面が表示されます。詳細は[章タイトル表示機能の実装ドキュメント](docs/chapter_title_implementation.md)を参照してください。

**主な特徴:**
- 大きな日本語タイトルと英語サブタイトルの表示
- 半透明の背景でゲーム画面が透けて見えるデザイン
- フェードイン/アウトアニメーション（各1秒）
- Enterキーでスキップ可能

## 🏗️ プロジェクト構造

```
Detective-Nocturne/
├── project.godot              # Godotプロジェクト設定
├── scenes/                    # シーンファイル
│   ├── Main.tscn             # メインシーン
│   ├── ChapterTitle.tscn     # 章タイトル表示シーン
│   ├── ui/                   # UIシーン
│   ├── characters/           # キャラクターシーン
│   └── backgrounds/          # 背景シーン
├── scripts/                   # スクリプトファイル
│   ├── GameManager.gd        # ゲーム全体管理
│   ├── DialogSystem.gd       # ダイアログシステム
│   ├── CharacterManager.gd   # キャラクター管理
│   ├── ScenarioManager.gd    # シナリオ管理 (データ駆動型)
│   ├── ChapterTitle.gd       # 章タイトル表示
│   ├── SaveSystem.gd         # セーブ・ロード
│   └── SettingsSystem.gd     # 設定システム
├── assets/                    # アセットファイル
│   ├── images/               # 画像ファイル
│   │   ├── characters/       # キャラクター画像
│   │   ├── backgrounds/      # 背景画像
│   │   └── ui/              # UI画像
│   ├── audio/               # 音声ファイル
│   │   ├── bgm/             # BGM
│   │   ├── se/              # 効果音
│   │   └── voice/           # ボイス
│   └── fonts/               # フォントファイル
├── data/                     # データファイル
│   ├── scenarios/            # シナリオデータ (.json)
│   ├── assets/               # アセットマニフェスト
│   │   └── manifest.json     # アセットパス定義
│   └── saves/               # セーブデータ
└── docs/                     # ドキュメント
    └── chapter_title_implementation.md  # 章タイトル表示機能の実装ドキュメント
```

## 🎮 操作方法

### 基本操作
- **テキスト送り**: マウスクリック / スペースキー / エンターキー
- **メニュー表示**: ESCキー
- **ダイアログボックス切り替**: 右クリック（実装予定）

### ゲーム機能
- **セーブ・ロード**: メニューからアクセス
- **設定**: 音量、テキスト速度、画面モードの調整
- **バックログ**: 過去の会話履歴表示（実装予定）
- **スキップ**: 既読テキストの高速スキップ（実装済み）

## 🎭 キャラクター

### 主要キャラクター

### 1. 水島みずき（探偵）

- **年齢**: 24歳
- **性格**: 冷静、論理的、実は温かい心を持つ
- **外見**: 黒髪ショート、クールな美人、スーツ姿、小柄。安産型かつ上半身細身。黒目、三白眼。
- **特徴**: 元警察官。知性と落ち着きを感じさせる表情と佇まい。

### 2. 田村沙織（探偵助手）

- **年齢**: 23歳
- **性格**: 純粋、優しい、性善説、責任感強い
- **外見**: 金髪ロング、ポニーテール。清楚な美人、メガネなし、巨乳、白セーター、黒いタイトスカート。優しい。
- detail:白いハイネックのブラウスを着用しており、胸元にはフリルが見られます。その上にダークカラーのベストとスカートを身につけています。豊かな胸元を持つグラマラスな体型。瞳は茶色。
- **特徴**: 幼なじみで最高の相棒。優しさと芯の強さを表現。

### 3. 一条瑠璃

- **年齢**: 19歳
- **性格**: 純粋、内向的、強い意志を秘める
- **外見**: 銀髪ロング、透明感のある美少女。ゴシックロリータファッション。
- **特徴**: 古代語の解読能力を持つ。繊細さと秘めたる強さを表現。

### 4. 長谷川（古美術商・教団幹部）

- **年齢**: 45歳
- **性格**: 狂信的、知識豊富、巧妙
- **外見**: 中年男性、知的な外見、冷たい目
- **特徴**: 主要敵役。冷徹さと狂気を内包した表情。

### 5. 田中（書店主・教団員）

- **年齢**: 50歳
- **性格**: 表面的に親切、内面は巧妙、卑怯。
- **外見**: 中年男性、人当たりの良い外見。中肉中背。
- **特徴**: 善良さを装う裏の顔。油断ならない雰囲気を表現。

### 6. 一条正宗（瑠璃の父親）

- **年齢**: 48歳
- **性格**: 狂気的な父性愛、支配的
- **外見**: 中年男性、疲れた表情、だがハイソサエティ。身なりはきちんとしている。
- **特徴**: 歪んだ愛情を持つ。苦悩と執着を表現。

## 🔧 開発情報

### 技術仕様
- **エンジン**: Godot 4.5
- **言語**: GDScript
- **解像度**: 1920x1080 (16:9)
- **レンダラー**: Vulkan (Forward+)
- **オーディオ**: OGG Vorbis形式
- **画像**: PNG形式

### 開発環境
- **OS**: Ubuntu 22.04
- **Godot**: 4.5-stable
- **Git**: バージョン管理
- **GitHub**: リポジトリホスティング

## 📝 ライセンス

このプロジェクトは開発中のため、現在ライセンスは未定です。

## 🤝 コントリビューション

現在このプロジェクトは個人開発中のため、外部からのコントリビューションは受け付けていません。

## 📞 サポート

バグ報告や質問については、GitHubのIssuesをご利用ください。

---

**注意**: このゲームは18歳以上を対象とした成人向けコンテンツを含みます。

